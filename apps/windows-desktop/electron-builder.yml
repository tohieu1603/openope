appId: com.operis.agent
productName: Agent Operis
copyright: Copyright (c) 2026 Agent Operis

directories:
  output: release
  buildResources: resources

asar: true
asarUnpack:
  - "**/node_modules/sharp/**/*"
  - "**/node_modules/better-sqlite3/**/*"
  - "**/*.node"

win:
  target:
    - target: nsis
      arch: [x64]
  icon: resources/icon.ico
  requestedExecutionLevel: asInvoker

nsis:
  oneClick: false
  perMachine: false
  allowToChangeInstallationDirectory: true
  createDesktopShortcut: true
  createStartMenuShortcut: true
  shortcutName: Agent Operis
  uninstallDisplayName: Agent Operis
  installerIcon: resources/icon.ico
  uninstallerIcon: resources/icon.ico
  installerHeaderIcon: resources/icon.ico
  deleteAppDataOnUninstall: false
  include: installer.nsh

extraResources:
  # Gateway dist (entry.js + deps)
  - from: "../../dist"
    to: "gateway"
    filter:
      - "**/*"
      - "!control-ui/**"
      - "!**/*.map"
      - "!**/*.d.ts"
  # Client-web UI build
  - from: "../../dist/control-ui"
    to: "client-web"
    filter:
      - "**/*"
      - "!**/*.map"
  # Cloudflare tunnel binary
  - from: "resources/cloudflared.exe"
    to: "cloudflared.exe"
  # First-run setup page
  - from: "resources/setup.html"
    to: "setup.html"
  # Tray status icons
  - from: "resources/tray-green.ico"
    to: "tray-green.ico"
  - from: "resources/tray-yellow.ico"
    to: "tray-yellow.ico"
  - from: "resources/tray-red.ico"
    to: "tray-red.ico"
  - from: "resources/tray-gray.ico"
    to: "tray-gray.ico"

files:
  - "dist-electron/**/*"
  - "!node_modules/@lydell/node-pty/**"
  - "!node_modules/playwright-core/**"
  - "!**/*.map"
